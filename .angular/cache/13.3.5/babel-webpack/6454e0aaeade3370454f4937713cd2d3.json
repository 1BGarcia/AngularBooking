{"ast":null,"code":"\"use strict\";\n/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nvar _asyncToGenerator = require(\"E:\\\\M7ProyectoAngular\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\asyncToGenerator.js\").default;\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.serveWebpackBrowser = void 0;\n\nconst architect_1 = require(\"@angular-devkit/architect\");\n\nconst build_webpack_1 = require(\"@angular-devkit/build-webpack\");\n\nconst core_1 = require(\"@angular-devkit/core\");\n\nconst path = __importStar(require(\"path\"));\n\nconst rxjs_1 = require(\"rxjs\");\n\nconst operators_1 = require(\"rxjs/operators\");\n\nconst url = __importStar(require(\"url\"));\n\nconst utils_1 = require(\"../../utils\");\n\nconst check_port_1 = require(\"../../utils/check-port\");\n\nconst color_1 = require(\"../../utils/color\");\n\nconst i18n_options_1 = require(\"../../utils/i18n-options\");\n\nconst load_translations_1 = require(\"../../utils/load-translations\");\n\nconst normalize_cache_1 = require(\"../../utils/normalize-cache\");\n\nconst package_chunk_sort_1 = require(\"../../utils/package-chunk-sort\");\n\nconst purge_cache_1 = require(\"../../utils/purge-cache\");\n\nconst version_1 = require(\"../../utils/version\");\n\nconst webpack_browser_config_1 = require(\"../../utils/webpack-browser-config\");\n\nconst webpack_diagnostics_1 = require(\"../../utils/webpack-diagnostics\");\n\nconst configs_1 = require(\"../../webpack/configs\");\n\nconst index_html_webpack_plugin_1 = require(\"../../webpack/plugins/index-html-webpack-plugin\");\n\nconst stats_1 = require(\"../../webpack/utils/stats\");\n\nconst schema_1 = require(\"../browser/schema\");\n/**\n * Reusable implementation of the Angular Webpack development server builder.\n * @param options Dev Server options.\n * @param context The build context.\n * @param transforms A map of transforms that can be used to hook into some logic (such as\n *     transforming webpack configuration before passing it to webpack).\n *\n * @experimental Direct usage of this function is considered experimental.\n */\n// eslint-disable-next-line max-lines-per-function\n\n\nfunction serveWebpackBrowser(options, context, transforms = {}) {\n  // Check Angular version.\n  const {\n    logger,\n    workspaceRoot\n  } = context;\n  (0, version_1.assertCompatibleAngularVersion)(workspaceRoot);\n  const browserTarget = (0, architect_1.targetFromTargetString)(options.browserTarget);\n\n  function setup() {\n    return _setup.apply(this, arguments);\n  }\n\n  function _setup() {\n    _setup = _asyncToGenerator(function* () {\n      var _a, _b, _c, _d;\n\n      const projectName = (_a = context.target) === null || _a === void 0 ? void 0 : _a.project;\n\n      if (!projectName) {\n        throw new Error('The builder requires a target.');\n      } // Purge old build disk cache.\n\n\n      yield (0, purge_cache_1.purgeStaleBuildCache)(context);\n      options.port = yield (0, check_port_1.checkPort)((_b = options.port) !== null && _b !== void 0 ? _b : 4200, options.host || 'localhost');\n\n      if (options.hmr) {\n        logger.warn(core_1.tags.stripIndents`NOTICE: Hot Module Replacement (HMR) is enabled for the dev server.\n      See https://webpack.js.org/guides/hot-module-replacement for information on working with HMR for Webpack.`);\n      }\n\n      if (!options.disableHostCheck && options.host && !/^127\\.\\d+\\.\\d+\\.\\d+/g.test(options.host) && options.host !== 'localhost') {\n        logger.warn(core_1.tags.stripIndent`\n        Warning: This is a simple server for use in testing or debugging Angular applications\n        locally. It hasn't been reviewed for security issues.\n\n        Binding this server to an open connection can result in compromising your application or\n        computer. Using a different host than the one passed to the \"--host\" flag might result in\n        websocket connection issues. You might need to use \"--disable-host-check\" if that's the\n        case.\n      `);\n      }\n\n      if (options.disableHostCheck) {\n        logger.warn(core_1.tags.oneLine`\n        Warning: Running a server with --disable-host-check is a security risk.\n        See https://medium.com/webpack/webpack-dev-server-middleware-security-issues-1489d950874a\n        for more information.\n      `);\n      } // Get the browser configuration from the target name.\n\n\n      const rawBrowserOptions = yield context.getTargetOptions(browserTarget);\n\n      if (rawBrowserOptions.outputHashing && rawBrowserOptions.outputHashing !== schema_1.OutputHashing.None) {\n        // Disable output hashing for dev build as this can cause memory leaks\n        // See: https://github.com/webpack/webpack-dev-server/issues/377#issuecomment-241258405\n        rawBrowserOptions.outputHashing = schema_1.OutputHashing.None;\n        logger.warn(`Warning: 'outputHashing' option is disabled when using the dev-server.`);\n      }\n\n      const metadata = yield context.getProjectMetadata(projectName);\n      const cacheOptions = (0, normalize_cache_1.normalizeCacheOptions)(metadata, context.workspaceRoot);\n      const browserName = yield context.getBuilderNameForTarget(browserTarget);\n      const browserOptions = yield context.validateOptions({ ...rawBrowserOptions,\n        watch: options.watch,\n        verbose: options.verbose,\n        // In dev server we should not have budgets because of extra libs such as socks-js\n        budgets: undefined\n      }, browserName);\n      const {\n        styles,\n        scripts\n      } = (0, utils_1.normalizeOptimization)(browserOptions.optimization);\n\n      if (scripts || styles.minify) {\n        logger.error(core_1.tags.stripIndents`\n        ****************************************************************************************\n        This is a simple server for use in testing or debugging Angular applications locally.\n        It hasn't been reviewed for security issues.\n\n        DON'T USE IT FOR PRODUCTION!\n        ****************************************************************************************\n      `);\n      }\n\n      const {\n        config,\n        projectRoot,\n        i18n\n      } = yield (0, webpack_browser_config_1.generateI18nBrowserWebpackConfigFromContext)(browserOptions, context, wco => [(0, configs_1.getDevServerConfig)(wco), (0, configs_1.getCommonConfig)(wco), (0, configs_1.getStylesConfig)(wco), (0, configs_1.getAnalyticsConfig)(wco, context)], options);\n\n      if (!config.devServer) {\n        throw new Error('Webpack Dev Server configuration was not set.');\n      }\n\n      let locale;\n\n      if (i18n.shouldInline) {\n        // Dev-server only supports one locale\n        locale = [...i18n.inlineLocales][0];\n      } else if (i18n.hasDefinedSourceLocale) {\n        // use source locale if not localizing\n        locale = i18n.sourceLocale;\n      }\n\n      let webpackConfig = config; // If a locale is defined, setup localization\n\n      if (locale) {\n        if (i18n.inlineLocales.size > 1) {\n          throw new Error('The development server only supports localizing a single locale per build.');\n        }\n\n        yield setupLocalize(locale, i18n, browserOptions, webpackConfig, cacheOptions, context);\n      }\n\n      if (transforms.webpackConfiguration) {\n        webpackConfig = yield transforms.webpackConfiguration(webpackConfig);\n      }\n\n      if (browserOptions.index) {\n        const {\n          scripts = [],\n          styles = [],\n          baseHref\n        } = browserOptions;\n        const entrypoints = (0, package_chunk_sort_1.generateEntryPoints)({\n          scripts,\n          styles,\n          // The below is needed as otherwise HMR for CSS will break.\n          // styles.js and runtime.js needs to be loaded as a non-module scripts as otherwise `document.currentScript` will be null.\n          // https://github.com/webpack-contrib/mini-css-extract-plugin/blob/90445dd1d81da0c10b9b0e8a17b417d0651816b8/src/hmr/hotModuleReplacement.js#L39\n          isHMREnabled: !!((_c = webpackConfig.devServer) === null || _c === void 0 ? void 0 : _c.hot)\n        });\n        (_d = webpackConfig.plugins) !== null && _d !== void 0 ? _d : webpackConfig.plugins = [];\n        webpackConfig.plugins.push(new index_html_webpack_plugin_1.IndexHtmlWebpackPlugin({\n          indexPath: path.resolve(workspaceRoot, (0, webpack_browser_config_1.getIndexInputFile)(browserOptions.index)),\n          outputPath: (0, webpack_browser_config_1.getIndexOutputFile)(browserOptions.index),\n          baseHref,\n          entrypoints,\n          deployUrl: browserOptions.deployUrl,\n          sri: browserOptions.subresourceIntegrity,\n          cache: cacheOptions,\n          postTransform: transforms.indexHtml,\n          optimization: (0, utils_1.normalizeOptimization)(browserOptions.optimization),\n          crossOrigin: browserOptions.crossOrigin,\n          lang: locale\n        }));\n      }\n\n      return {\n        browserOptions,\n        webpackConfig,\n        projectRoot\n      };\n    });\n    return _setup.apply(this, arguments);\n  }\n\n  return (0, rxjs_1.from)(setup()).pipe((0, operators_1.switchMap)(({\n    browserOptions,\n    webpackConfig\n  }) => {\n    return (0, build_webpack_1.runWebpackDevServer)(webpackConfig, context, {\n      logging: transforms.logging || (0, stats_1.createWebpackLoggingCallback)(browserOptions, logger),\n      webpackFactory: require('webpack'),\n      webpackDevServerFactory: require('webpack-dev-server')\n    }).pipe((0, operators_1.concatMap)( /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (buildEvent, index) {\n        var _a, _b; // Resolve serve address.\n\n\n        const publicPath = (_b = (_a = webpackConfig.devServer) === null || _a === void 0 ? void 0 : _a.devMiddleware) === null || _b === void 0 ? void 0 : _b.publicPath;\n        const serverAddress = url.format({\n          protocol: options.ssl ? 'https' : 'http',\n          hostname: options.host === '0.0.0.0' ? 'localhost' : options.host,\n          port: buildEvent.port,\n          pathname: typeof publicPath === 'string' ? publicPath : undefined\n        });\n\n        if (index === 0) {\n          logger.info('\\n' + core_1.tags.oneLine`\n              **\n              Angular Live Development Server is listening on ${options.host}:${buildEvent.port},\n              open your browser on ${serverAddress}\n              **\n            ` + '\\n');\n\n          if (options.open) {\n            const open = (yield Promise.resolve().then(() => __importStar(require('open')))).default;\n            yield open(serverAddress);\n          }\n        }\n\n        if (buildEvent.success) {\n          logger.info(`\\n${color_1.colors.greenBright(color_1.colors.symbols.check)} Compiled successfully.`);\n        } else {\n          logger.info(`\\n${color_1.colors.redBright(color_1.colors.symbols.cross)} Failed to compile.`);\n        }\n\n        return { ...buildEvent,\n          baseUrl: serverAddress\n        };\n      });\n\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }()));\n  }));\n}\n\nexports.serveWebpackBrowser = serveWebpackBrowser;\n\nfunction setupLocalize(_x3, _x4, _x5, _x6, _x7, _x8) {\n  return _setupLocalize.apply(this, arguments);\n}\n\nfunction _setupLocalize() {\n  _setupLocalize = _asyncToGenerator(function* (locale, i18n, browserOptions, webpackConfig, cacheOptions, context) {\n    var _a;\n\n    const localeDescription = i18n.locales[locale]; // Modify main entrypoint to include locale data\n\n    if ((localeDescription === null || localeDescription === void 0 ? void 0 : localeDescription.dataPath) && typeof webpackConfig.entry === 'object' && !Array.isArray(webpackConfig.entry) && webpackConfig.entry['main']) {\n      if (Array.isArray(webpackConfig.entry['main'])) {\n        webpackConfig.entry['main'].unshift(localeDescription.dataPath);\n      } else {\n        webpackConfig.entry['main'] = [localeDescription.dataPath, webpackConfig.entry['main']];\n      }\n    }\n\n    let missingTranslationBehavior = browserOptions.i18nMissingTranslation || 'ignore';\n    let translation = (localeDescription === null || localeDescription === void 0 ? void 0 : localeDescription.translation) || {};\n\n    if (locale === i18n.sourceLocale) {\n      missingTranslationBehavior = 'ignore';\n      translation = {};\n    }\n\n    const i18nLoaderOptions = {\n      locale,\n      missingTranslationBehavior,\n      translation: i18n.shouldInline ? translation : undefined,\n      translationFiles: localeDescription === null || localeDescription === void 0 ? void 0 : localeDescription.files.map(file => path.resolve(context.workspaceRoot, file.path))\n    };\n    const i18nRule = {\n      test: /\\.[cm]?[tj]sx?$/,\n      enforce: 'post',\n      use: [{\n        loader: require.resolve('../../babel/webpack-loader'),\n        options: {\n          cacheDirectory: cacheOptions.enabled && path.join(cacheOptions.path, 'babel-dev-server-i18n') || false,\n          cacheIdentifier: JSON.stringify({\n            locale,\n            translationIntegrity: localeDescription === null || localeDescription === void 0 ? void 0 : localeDescription.files.map(file => file.integrity)\n          }),\n          i18n: i18nLoaderOptions\n        }\n      }]\n    }; // Get the rules and ensure the Webpack configuration is setup properly\n\n    const rules = ((_a = webpackConfig.module) === null || _a === void 0 ? void 0 : _a.rules) || [];\n\n    if (!webpackConfig.module) {\n      webpackConfig.module = {\n        rules\n      };\n    } else if (!webpackConfig.module.rules) {\n      webpackConfig.module.rules = rules;\n    }\n\n    rules.push(i18nRule); // Add a plugin to reload translation files on rebuilds\n\n    const loader = yield (0, load_translations_1.createTranslationLoader)(); // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\n    webpackConfig.plugins.push({\n      apply: compiler => {\n        compiler.hooks.thisCompilation.tap('build-angular', compilation => {\n          var _a;\n\n          if (i18n.shouldInline && i18nLoaderOptions.translation === undefined) {\n            // Reload translations\n            (0, i18n_options_1.loadTranslations)(locale, localeDescription, context.workspaceRoot, loader, {\n              warn(message) {\n                (0, webpack_diagnostics_1.addWarning)(compilation, message);\n              },\n\n              error(message) {\n                (0, webpack_diagnostics_1.addError)(compilation, message);\n              }\n\n            }, undefined, browserOptions.i18nDuplicateTranslation);\n            i18nLoaderOptions.translation = (_a = localeDescription.translation) !== null && _a !== void 0 ? _a : {};\n          }\n\n          compilation.hooks.finishModules.tap('build-angular', () => {\n            // After loaders are finished, clear out the now unneeded translations\n            i18nLoaderOptions.translation = undefined;\n          });\n        });\n      }\n    });\n  });\n  return _setupLocalize.apply(this, arguments);\n}\n\nexports.default = (0, architect_1.createBuilder)(serveWebpackBrowser);","map":{"version":3,"sources":["E:/M7ProyectoAngular/node_modules/@angular-devkit/build-angular/src/builders/dev-server/index.js"],"names":["__createBinding","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","exports","serveWebpackBrowser","architect_1","require","build_webpack_1","core_1","path","rxjs_1","operators_1","url","utils_1","check_port_1","color_1","i18n_options_1","load_translations_1","normalize_cache_1","package_chunk_sort_1","purge_cache_1","version_1","webpack_browser_config_1","webpack_diagnostics_1","configs_1","index_html_webpack_plugin_1","stats_1","schema_1","options","context","transforms","logger","workspaceRoot","assertCompatibleAngularVersion","browserTarget","targetFromTargetString","setup","_a","_b","_c","_d","projectName","target","project","Error","purgeStaleBuildCache","port","checkPort","host","hmr","warn","tags","stripIndents","disableHostCheck","test","stripIndent","oneLine","rawBrowserOptions","getTargetOptions","outputHashing","OutputHashing","None","metadata","getProjectMetadata","cacheOptions","normalizeCacheOptions","browserName","getBuilderNameForTarget","browserOptions","validateOptions","watch","verbose","budgets","styles","scripts","normalizeOptimization","optimization","minify","error","config","projectRoot","i18n","generateI18nBrowserWebpackConfigFromContext","wco","getDevServerConfig","getCommonConfig","getStylesConfig","getAnalyticsConfig","devServer","locale","shouldInline","inlineLocales","hasDefinedSourceLocale","sourceLocale","webpackConfig","size","setupLocalize","webpackConfiguration","index","baseHref","entrypoints","generateEntryPoints","isHMREnabled","hot","plugins","push","IndexHtmlWebpackPlugin","indexPath","resolve","getIndexInputFile","outputPath","getIndexOutputFile","deployUrl","sri","subresourceIntegrity","cache","postTransform","indexHtml","crossOrigin","lang","from","pipe","switchMap","runWebpackDevServer","logging","createWebpackLoggingCallback","webpackFactory","webpackDevServerFactory","concatMap","buildEvent","publicPath","devMiddleware","serverAddress","format","protocol","ssl","hostname","pathname","info","open","Promise","then","default","success","colors","greenBright","symbols","check","redBright","cross","baseUrl","localeDescription","locales","dataPath","entry","Array","isArray","unshift","missingTranslationBehavior","i18nMissingTranslation","translation","i18nLoaderOptions","translationFiles","files","map","file","i18nRule","enforce","use","loader","cacheDirectory","enabled","join","cacheIdentifier","JSON","stringify","translationIntegrity","integrity","rules","module","createTranslationLoader","apply","compiler","hooks","thisCompilation","tap","compilation","loadTranslations","message","addWarning","addError","i18nDuplicateTranslation","finishModules","createBuilder"],"mappings":"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","sourcesContent":["\"use strict\";\n/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.serveWebpackBrowser = void 0;\nconst architect_1 = require(\"@angular-devkit/architect\");\nconst build_webpack_1 = require(\"@angular-devkit/build-webpack\");\nconst core_1 = require(\"@angular-devkit/core\");\nconst path = __importStar(require(\"path\"));\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst url = __importStar(require(\"url\"));\nconst utils_1 = require(\"../../utils\");\nconst check_port_1 = require(\"../../utils/check-port\");\nconst color_1 = require(\"../../utils/color\");\nconst i18n_options_1 = require(\"../../utils/i18n-options\");\nconst load_translations_1 = require(\"../../utils/load-translations\");\nconst normalize_cache_1 = require(\"../../utils/normalize-cache\");\nconst package_chunk_sort_1 = require(\"../../utils/package-chunk-sort\");\nconst purge_cache_1 = require(\"../../utils/purge-cache\");\nconst version_1 = require(\"../../utils/version\");\nconst webpack_browser_config_1 = require(\"../../utils/webpack-browser-config\");\nconst webpack_diagnostics_1 = require(\"../../utils/webpack-diagnostics\");\nconst configs_1 = require(\"../../webpack/configs\");\nconst index_html_webpack_plugin_1 = require(\"../../webpack/plugins/index-html-webpack-plugin\");\nconst stats_1 = require(\"../../webpack/utils/stats\");\nconst schema_1 = require(\"../browser/schema\");\n/**\n * Reusable implementation of the Angular Webpack development server builder.\n * @param options Dev Server options.\n * @param context The build context.\n * @param transforms A map of transforms that can be used to hook into some logic (such as\n *     transforming webpack configuration before passing it to webpack).\n *\n * @experimental Direct usage of this function is considered experimental.\n */\n// eslint-disable-next-line max-lines-per-function\nfunction serveWebpackBrowser(options, context, transforms = {}) {\n    // Check Angular version.\n    const { logger, workspaceRoot } = context;\n    (0, version_1.assertCompatibleAngularVersion)(workspaceRoot);\n    const browserTarget = (0, architect_1.targetFromTargetString)(options.browserTarget);\n    async function setup() {\n        var _a, _b, _c, _d;\n        const projectName = (_a = context.target) === null || _a === void 0 ? void 0 : _a.project;\n        if (!projectName) {\n            throw new Error('The builder requires a target.');\n        }\n        // Purge old build disk cache.\n        await (0, purge_cache_1.purgeStaleBuildCache)(context);\n        options.port = await (0, check_port_1.checkPort)((_b = options.port) !== null && _b !== void 0 ? _b : 4200, options.host || 'localhost');\n        if (options.hmr) {\n            logger.warn(core_1.tags.stripIndents `NOTICE: Hot Module Replacement (HMR) is enabled for the dev server.\n      See https://webpack.js.org/guides/hot-module-replacement for information on working with HMR for Webpack.`);\n        }\n        if (!options.disableHostCheck &&\n            options.host &&\n            !/^127\\.\\d+\\.\\d+\\.\\d+/g.test(options.host) &&\n            options.host !== 'localhost') {\n            logger.warn(core_1.tags.stripIndent `\n        Warning: This is a simple server for use in testing or debugging Angular applications\n        locally. It hasn't been reviewed for security issues.\n\n        Binding this server to an open connection can result in compromising your application or\n        computer. Using a different host than the one passed to the \"--host\" flag might result in\n        websocket connection issues. You might need to use \"--disable-host-check\" if that's the\n        case.\n      `);\n        }\n        if (options.disableHostCheck) {\n            logger.warn(core_1.tags.oneLine `\n        Warning: Running a server with --disable-host-check is a security risk.\n        See https://medium.com/webpack/webpack-dev-server-middleware-security-issues-1489d950874a\n        for more information.\n      `);\n        }\n        // Get the browser configuration from the target name.\n        const rawBrowserOptions = (await context.getTargetOptions(browserTarget));\n        if (rawBrowserOptions.outputHashing && rawBrowserOptions.outputHashing !== schema_1.OutputHashing.None) {\n            // Disable output hashing for dev build as this can cause memory leaks\n            // See: https://github.com/webpack/webpack-dev-server/issues/377#issuecomment-241258405\n            rawBrowserOptions.outputHashing = schema_1.OutputHashing.None;\n            logger.warn(`Warning: 'outputHashing' option is disabled when using the dev-server.`);\n        }\n        const metadata = await context.getProjectMetadata(projectName);\n        const cacheOptions = (0, normalize_cache_1.normalizeCacheOptions)(metadata, context.workspaceRoot);\n        const browserName = await context.getBuilderNameForTarget(browserTarget);\n        const browserOptions = (await context.validateOptions({\n            ...rawBrowserOptions,\n            watch: options.watch,\n            verbose: options.verbose,\n            // In dev server we should not have budgets because of extra libs such as socks-js\n            budgets: undefined,\n        }, browserName));\n        const { styles, scripts } = (0, utils_1.normalizeOptimization)(browserOptions.optimization);\n        if (scripts || styles.minify) {\n            logger.error(core_1.tags.stripIndents `\n        ****************************************************************************************\n        This is a simple server for use in testing or debugging Angular applications locally.\n        It hasn't been reviewed for security issues.\n\n        DON'T USE IT FOR PRODUCTION!\n        ****************************************************************************************\n      `);\n        }\n        const { config, projectRoot, i18n } = await (0, webpack_browser_config_1.generateI18nBrowserWebpackConfigFromContext)(browserOptions, context, (wco) => [\n            (0, configs_1.getDevServerConfig)(wco),\n            (0, configs_1.getCommonConfig)(wco),\n            (0, configs_1.getStylesConfig)(wco),\n            (0, configs_1.getAnalyticsConfig)(wco, context),\n        ], options);\n        if (!config.devServer) {\n            throw new Error('Webpack Dev Server configuration was not set.');\n        }\n        let locale;\n        if (i18n.shouldInline) {\n            // Dev-server only supports one locale\n            locale = [...i18n.inlineLocales][0];\n        }\n        else if (i18n.hasDefinedSourceLocale) {\n            // use source locale if not localizing\n            locale = i18n.sourceLocale;\n        }\n        let webpackConfig = config;\n        // If a locale is defined, setup localization\n        if (locale) {\n            if (i18n.inlineLocales.size > 1) {\n                throw new Error('The development server only supports localizing a single locale per build.');\n            }\n            await setupLocalize(locale, i18n, browserOptions, webpackConfig, cacheOptions, context);\n        }\n        if (transforms.webpackConfiguration) {\n            webpackConfig = await transforms.webpackConfiguration(webpackConfig);\n        }\n        if (browserOptions.index) {\n            const { scripts = [], styles = [], baseHref } = browserOptions;\n            const entrypoints = (0, package_chunk_sort_1.generateEntryPoints)({\n                scripts,\n                styles,\n                // The below is needed as otherwise HMR for CSS will break.\n                // styles.js and runtime.js needs to be loaded as a non-module scripts as otherwise `document.currentScript` will be null.\n                // https://github.com/webpack-contrib/mini-css-extract-plugin/blob/90445dd1d81da0c10b9b0e8a17b417d0651816b8/src/hmr/hotModuleReplacement.js#L39\n                isHMREnabled: !!((_c = webpackConfig.devServer) === null || _c === void 0 ? void 0 : _c.hot),\n            });\n            (_d = webpackConfig.plugins) !== null && _d !== void 0 ? _d : (webpackConfig.plugins = []);\n            webpackConfig.plugins.push(new index_html_webpack_plugin_1.IndexHtmlWebpackPlugin({\n                indexPath: path.resolve(workspaceRoot, (0, webpack_browser_config_1.getIndexInputFile)(browserOptions.index)),\n                outputPath: (0, webpack_browser_config_1.getIndexOutputFile)(browserOptions.index),\n                baseHref,\n                entrypoints,\n                deployUrl: browserOptions.deployUrl,\n                sri: browserOptions.subresourceIntegrity,\n                cache: cacheOptions,\n                postTransform: transforms.indexHtml,\n                optimization: (0, utils_1.normalizeOptimization)(browserOptions.optimization),\n                crossOrigin: browserOptions.crossOrigin,\n                lang: locale,\n            }));\n        }\n        return {\n            browserOptions,\n            webpackConfig,\n            projectRoot,\n        };\n    }\n    return (0, rxjs_1.from)(setup()).pipe((0, operators_1.switchMap)(({ browserOptions, webpackConfig }) => {\n        return (0, build_webpack_1.runWebpackDevServer)(webpackConfig, context, {\n            logging: transforms.logging || (0, stats_1.createWebpackLoggingCallback)(browserOptions, logger),\n            webpackFactory: require('webpack'),\n            webpackDevServerFactory: require('webpack-dev-server'),\n        }).pipe((0, operators_1.concatMap)(async (buildEvent, index) => {\n            var _a, _b;\n            // Resolve serve address.\n            const publicPath = (_b = (_a = webpackConfig.devServer) === null || _a === void 0 ? void 0 : _a.devMiddleware) === null || _b === void 0 ? void 0 : _b.publicPath;\n            const serverAddress = url.format({\n                protocol: options.ssl ? 'https' : 'http',\n                hostname: options.host === '0.0.0.0' ? 'localhost' : options.host,\n                port: buildEvent.port,\n                pathname: typeof publicPath === 'string' ? publicPath : undefined,\n            });\n            if (index === 0) {\n                logger.info('\\n' +\n                    core_1.tags.oneLine `\n              **\n              Angular Live Development Server is listening on ${options.host}:${buildEvent.port},\n              open your browser on ${serverAddress}\n              **\n            ` +\n                    '\\n');\n                if (options.open) {\n                    const open = (await Promise.resolve().then(() => __importStar(require('open')))).default;\n                    await open(serverAddress);\n                }\n            }\n            if (buildEvent.success) {\n                logger.info(`\\n${color_1.colors.greenBright(color_1.colors.symbols.check)} Compiled successfully.`);\n            }\n            else {\n                logger.info(`\\n${color_1.colors.redBright(color_1.colors.symbols.cross)} Failed to compile.`);\n            }\n            return { ...buildEvent, baseUrl: serverAddress };\n        }));\n    }));\n}\nexports.serveWebpackBrowser = serveWebpackBrowser;\nasync function setupLocalize(locale, i18n, browserOptions, webpackConfig, cacheOptions, context) {\n    var _a;\n    const localeDescription = i18n.locales[locale];\n    // Modify main entrypoint to include locale data\n    if ((localeDescription === null || localeDescription === void 0 ? void 0 : localeDescription.dataPath) &&\n        typeof webpackConfig.entry === 'object' &&\n        !Array.isArray(webpackConfig.entry) &&\n        webpackConfig.entry['main']) {\n        if (Array.isArray(webpackConfig.entry['main'])) {\n            webpackConfig.entry['main'].unshift(localeDescription.dataPath);\n        }\n        else {\n            webpackConfig.entry['main'] = [\n                localeDescription.dataPath,\n                webpackConfig.entry['main'],\n            ];\n        }\n    }\n    let missingTranslationBehavior = browserOptions.i18nMissingTranslation || 'ignore';\n    let translation = (localeDescription === null || localeDescription === void 0 ? void 0 : localeDescription.translation) || {};\n    if (locale === i18n.sourceLocale) {\n        missingTranslationBehavior = 'ignore';\n        translation = {};\n    }\n    const i18nLoaderOptions = {\n        locale,\n        missingTranslationBehavior,\n        translation: i18n.shouldInline ? translation : undefined,\n        translationFiles: localeDescription === null || localeDescription === void 0 ? void 0 : localeDescription.files.map((file) => path.resolve(context.workspaceRoot, file.path)),\n    };\n    const i18nRule = {\n        test: /\\.[cm]?[tj]sx?$/,\n        enforce: 'post',\n        use: [\n            {\n                loader: require.resolve('../../babel/webpack-loader'),\n                options: {\n                    cacheDirectory: (cacheOptions.enabled && path.join(cacheOptions.path, 'babel-dev-server-i18n')) ||\n                        false,\n                    cacheIdentifier: JSON.stringify({\n                        locale,\n                        translationIntegrity: localeDescription === null || localeDescription === void 0 ? void 0 : localeDescription.files.map((file) => file.integrity),\n                    }),\n                    i18n: i18nLoaderOptions,\n                },\n            },\n        ],\n    };\n    // Get the rules and ensure the Webpack configuration is setup properly\n    const rules = ((_a = webpackConfig.module) === null || _a === void 0 ? void 0 : _a.rules) || [];\n    if (!webpackConfig.module) {\n        webpackConfig.module = { rules };\n    }\n    else if (!webpackConfig.module.rules) {\n        webpackConfig.module.rules = rules;\n    }\n    rules.push(i18nRule);\n    // Add a plugin to reload translation files on rebuilds\n    const loader = await (0, load_translations_1.createTranslationLoader)();\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    webpackConfig.plugins.push({\n        apply: (compiler) => {\n            compiler.hooks.thisCompilation.tap('build-angular', (compilation) => {\n                var _a;\n                if (i18n.shouldInline && i18nLoaderOptions.translation === undefined) {\n                    // Reload translations\n                    (0, i18n_options_1.loadTranslations)(locale, localeDescription, context.workspaceRoot, loader, {\n                        warn(message) {\n                            (0, webpack_diagnostics_1.addWarning)(compilation, message);\n                        },\n                        error(message) {\n                            (0, webpack_diagnostics_1.addError)(compilation, message);\n                        },\n                    }, undefined, browserOptions.i18nDuplicateTranslation);\n                    i18nLoaderOptions.translation = (_a = localeDescription.translation) !== null && _a !== void 0 ? _a : {};\n                }\n                compilation.hooks.finishModules.tap('build-angular', () => {\n                    // After loaders are finished, clear out the now unneeded translations\n                    i18nLoaderOptions.translation = undefined;\n                });\n            });\n        },\n    });\n}\nexports.default = (0, architect_1.createBuilder)(serveWebpackBrowser);\n"]},"metadata":{},"sourceType":"script"}