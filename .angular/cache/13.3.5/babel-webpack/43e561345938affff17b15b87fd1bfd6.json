{"ast":null,"code":"'use strict';\n\nvar _asyncToGenerator = require(\"E:\\\\M7ProyectoAngular\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\asyncToGenerator.js\").default;\n\nconst util = require('util');\n\nconst fs = require('graceful-fs'); // bind need only for mock unit tests\n\n\nconst readFile = util.promisify(fs.readFile.bind(fs));\n\nconst tryToRead = function (path, log) {\n  const maxRetries = 3;\n  let promise = readFile(path);\n\n  for (let retryCount = 1; retryCount <= maxRetries; retryCount++) {\n    promise = promise.catch(err => {\n      log.warn(err);\n      log.warn('retrying ' + retryCount);\n      return readFile(path);\n    });\n  }\n\n  return promise.catch(err => {\n    log.warn(err);\n    return Promise.reject(err);\n  });\n};\n\nconst mm = require('minimatch');\n\nconst {\n  isBinaryFile\n} = require('isbinaryfile');\n\nconst _ = require('lodash');\n\nconst CryptoUtils = require('./utils/crypto-utils');\n\nconst log = require('./logger').create('preprocess');\n\nfunction executeProcessor(process, file, content) {\n  let done = null;\n  const donePromise = new Promise((resolve, reject) => {\n    done = function (error, content) {\n      // normalize B-C\n      if (arguments.length === 1 && typeof error === 'string') {\n        content = error;\n        error = null;\n      }\n\n      if (error) {\n        reject(error);\n      } else {\n        resolve(content);\n      }\n    };\n  });\n  return (process(content, file, done) || Promise.resolve()).then(content => {\n    if (content) {\n      // async process correctly returned content\n      return content;\n    } // process called done() (Either old sync api or an async function that did not return content)\n\n\n    return donePromise;\n  });\n}\n\nfunction runProcessors(_x, _x2, _x3) {\n  return _runProcessors.apply(this, arguments);\n}\n\nfunction _runProcessors() {\n  _runProcessors = _asyncToGenerator(function* (preprocessors, file, content) {\n    try {\n      for (const process of preprocessors) {\n        content = yield executeProcessor(process, file, content);\n      }\n    } catch (error) {\n      file.contentPath = null;\n      file.content = null;\n      throw error;\n    }\n\n    file.contentPath = null;\n    file.content = content;\n    file.sha = CryptoUtils.sha1(content);\n  });\n  return _runProcessors.apply(this, arguments);\n}\n\nfunction createPriorityPreprocessor(config = {}, preprocessorPriority, basePath, instantiatePlugin) {\n  _.union.apply(_, Object.values(config)).forEach(name => instantiatePlugin('preprocessor', name));\n\n  return /*#__PURE__*/function () {\n    var _preprocess = _asyncToGenerator(function* (file) {\n      const buffer = yield tryToRead(file.originalPath, log);\n      let isBinary = file.isBinary;\n\n      if (isBinary == null) {\n        // Pattern did not specify, probe for it.\n        isBinary = yield isBinaryFile(buffer, buffer.length);\n      }\n\n      const preprocessorNames = Object.keys(config).reduce((ppNames, pattern) => {\n        if (mm(file.originalPath, pattern, {\n          dot: true\n        })) {\n          ppNames = _.union(ppNames, config[pattern]);\n        }\n\n        return ppNames;\n      }, []); // Apply preprocessor priority.\n\n      const preprocessors = preprocessorNames.map(name => [name, preprocessorPriority[name] || 0]).sort((a, b) => b[1] - a[1]).map(duo => duo[0]).reduce((preProcs, name) => {\n        const p = instantiatePlugin('preprocessor', name);\n\n        if (!isBinary || p && p.handleBinaryFiles) {\n          preProcs.push(p);\n        } else {\n          log.warn(`Ignored preprocessing ${file.originalPath} because ${name} has handleBinaryFiles=false.`);\n        }\n\n        return preProcs;\n      }, []);\n      yield runProcessors(preprocessors, file, isBinary ? buffer : buffer.toString());\n    });\n\n    function preprocess(_x4) {\n      return _preprocess.apply(this, arguments);\n    }\n\n    return preprocess;\n  }();\n}\n\ncreatePriorityPreprocessor.$inject = ['config.preprocessors', 'config.preprocessor_priority', 'config.basePath', 'instantiatePlugin'];\nexports.createPriorityPreprocessor = createPriorityPreprocessor;","map":{"version":3,"sources":["E:/M7ProyectoAngular/node_modules/karma/lib/preprocessor.js"],"names":["util","require","fs","readFile","promisify","bind","tryToRead","path","log","maxRetries","promise","retryCount","catch","err","warn","Promise","reject","mm","isBinaryFile","_","CryptoUtils","create","executeProcessor","process","file","content","done","donePromise","resolve","error","arguments","length","then","runProcessors","preprocessors","contentPath","sha","sha1","createPriorityPreprocessor","config","preprocessorPriority","basePath","instantiatePlugin","union","apply","Object","values","forEach","name","buffer","originalPath","isBinary","preprocessorNames","keys","reduce","ppNames","pattern","dot","map","sort","a","b","duo","preProcs","p","handleBinaryFiles","push","toString","preprocess","$inject","exports"],"mappings":"AAAA;;;;AAEA,MAAMA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAApB;;AACA,MAAMC,EAAE,GAAGD,OAAO,CAAC,aAAD,CAAlB,C,CACA;;;AACA,MAAME,QAAQ,GAAGH,IAAI,CAACI,SAAL,CAAeF,EAAE,CAACC,QAAH,CAAYE,IAAZ,CAAiBH,EAAjB,CAAf,CAAjB;;AACA,MAAMI,SAAS,GAAG,UAAUC,IAAV,EAAgBC,GAAhB,EAAqB;AACrC,QAAMC,UAAU,GAAG,CAAnB;AACA,MAAIC,OAAO,GAAGP,QAAQ,CAACI,IAAD,CAAtB;;AACA,OAAK,IAAII,UAAU,GAAG,CAAtB,EAAyBA,UAAU,IAAIF,UAAvC,EAAmDE,UAAU,EAA7D,EAAiE;AAC/DD,IAAAA,OAAO,GAAGA,OAAO,CAACE,KAAR,CAAeC,GAAD,IAAS;AAC/BL,MAAAA,GAAG,CAACM,IAAJ,CAASD,GAAT;AACAL,MAAAA,GAAG,CAACM,IAAJ,CAAS,cAAcH,UAAvB;AACA,aAAOR,QAAQ,CAACI,IAAD,CAAf;AACD,KAJS,CAAV;AAKD;;AACD,SAAOG,OAAO,CAACE,KAAR,CAAeC,GAAD,IAAS;AAC5BL,IAAAA,GAAG,CAACM,IAAJ,CAASD,GAAT;AACA,WAAOE,OAAO,CAACC,MAAR,CAAeH,GAAf,CAAP;AACD,GAHM,CAAP;AAID,CAdD;;AAgBA,MAAMI,EAAE,GAAGhB,OAAO,CAAC,WAAD,CAAlB;;AACA,MAAM;AAAEiB,EAAAA;AAAF,IAAmBjB,OAAO,CAAC,cAAD,CAAhC;;AACA,MAAMkB,CAAC,GAAGlB,OAAO,CAAC,QAAD,CAAjB;;AACA,MAAMmB,WAAW,GAAGnB,OAAO,CAAC,sBAAD,CAA3B;;AAEA,MAAMO,GAAG,GAAGP,OAAO,CAAC,UAAD,CAAP,CAAoBoB,MAApB,CAA2B,YAA3B,CAAZ;;AAEA,SAASC,gBAAT,CAA2BC,OAA3B,EAAoCC,IAApC,EAA0CC,OAA1C,EAAmD;AACjD,MAAIC,IAAI,GAAG,IAAX;AACA,QAAMC,WAAW,GAAG,IAAIZ,OAAJ,CAAY,CAACa,OAAD,EAAUZ,MAAV,KAAqB;AACnDU,IAAAA,IAAI,GAAG,UAAUG,KAAV,EAAiBJ,OAAjB,EAA0B;AAC/B;AACA,UAAIK,SAAS,CAACC,MAAV,KAAqB,CAArB,IAA0B,OAAOF,KAAP,KAAiB,QAA/C,EAAyD;AACvDJ,QAAAA,OAAO,GAAGI,KAAV;AACAA,QAAAA,KAAK,GAAG,IAAR;AACD;;AACD,UAAIA,KAAJ,EAAW;AACTb,QAAAA,MAAM,CAACa,KAAD,CAAN;AACD,OAFD,MAEO;AACLD,QAAAA,OAAO,CAACH,OAAD,CAAP;AACD;AACF,KAXD;AAYD,GAbmB,CAApB;AAeA,SAAO,CAACF,OAAO,CAACE,OAAD,EAAUD,IAAV,EAAgBE,IAAhB,CAAP,IAAgCX,OAAO,CAACa,OAAR,EAAjC,EAAoDI,IAApD,CAA0DP,OAAD,IAAa;AAC3E,QAAIA,OAAJ,EAAa;AACX;AACA,aAAOA,OAAP;AACD,KAJ0E,CAK3E;;;AACA,WAAOE,WAAP;AACD,GAPM,CAAP;AAQD;;SAEcM,a;;;;;qCAAf,WAA8BC,aAA9B,EAA6CV,IAA7C,EAAmDC,OAAnD,EAA4D;AAC1D,QAAI;AACF,WAAK,MAAMF,OAAX,IAAsBW,aAAtB,EAAqC;AACnCT,QAAAA,OAAO,SAASH,gBAAgB,CAACC,OAAD,EAAUC,IAAV,EAAgBC,OAAhB,CAAhC;AACD;AACF,KAJD,CAIE,OAAOI,KAAP,EAAc;AACdL,MAAAA,IAAI,CAACW,WAAL,GAAmB,IAAnB;AACAX,MAAAA,IAAI,CAACC,OAAL,GAAe,IAAf;AACA,YAAMI,KAAN;AACD;;AAEDL,IAAAA,IAAI,CAACW,WAAL,GAAmB,IAAnB;AACAX,IAAAA,IAAI,CAACC,OAAL,GAAeA,OAAf;AACAD,IAAAA,IAAI,CAACY,GAAL,GAAWhB,WAAW,CAACiB,IAAZ,CAAiBZ,OAAjB,CAAX;AACD,G;;;;AAED,SAASa,0BAAT,CAAqCC,MAAM,GAAG,EAA9C,EAAkDC,oBAAlD,EAAwEC,QAAxE,EAAkFC,iBAAlF,EAAqG;AACnGvB,EAAAA,CAAC,CAACwB,KAAF,CAAQC,KAAR,CAAczB,CAAd,EAAiB0B,MAAM,CAACC,MAAP,CAAcP,MAAd,CAAjB,EAAwCQ,OAAxC,CAAiDC,IAAD,IAAUN,iBAAiB,CAAC,cAAD,EAAiBM,IAAjB,CAA3E;;AACA;AAAA,wCAAO,WAA2BxB,IAA3B,EAAiC;AACtC,YAAMyB,MAAM,SAAS3C,SAAS,CAACkB,IAAI,CAAC0B,YAAN,EAAoB1C,GAApB,CAA9B;AACA,UAAI2C,QAAQ,GAAG3B,IAAI,CAAC2B,QAApB;;AACA,UAAIA,QAAQ,IAAI,IAAhB,EAAsB;AACpB;AACAA,QAAAA,QAAQ,SAASjC,YAAY,CAAC+B,MAAD,EAASA,MAAM,CAAClB,MAAhB,CAA7B;AACD;;AAED,YAAMqB,iBAAiB,GAAGP,MAAM,CAACQ,IAAP,CAAYd,MAAZ,EAAoBe,MAApB,CAA2B,CAACC,OAAD,EAAUC,OAAV,KAAsB;AACzE,YAAIvC,EAAE,CAACO,IAAI,CAAC0B,YAAN,EAAoBM,OAApB,EAA6B;AAAEC,UAAAA,GAAG,EAAE;AAAP,SAA7B,CAAN,EAAmD;AACjDF,UAAAA,OAAO,GAAGpC,CAAC,CAACwB,KAAF,CAAQY,OAAR,EAAiBhB,MAAM,CAACiB,OAAD,CAAvB,CAAV;AACD;;AACD,eAAOD,OAAP;AACD,OALyB,EAKvB,EALuB,CAA1B,CARsC,CAetC;;AACA,YAAMrB,aAAa,GAAGkB,iBAAiB,CACpCM,GADmB,CACdV,IAAD,IAAU,CAACA,IAAD,EAAOR,oBAAoB,CAACQ,IAAD,CAApB,IAA8B,CAArC,CADK,EAEnBW,IAFmB,CAEd,CAACC,CAAD,EAAIC,CAAJ,KAAUA,CAAC,CAAC,CAAD,CAAD,GAAOD,CAAC,CAAC,CAAD,CAFJ,EAGnBF,GAHmB,CAGdI,GAAD,IAASA,GAAG,CAAC,CAAD,CAHG,EAInBR,MAJmB,CAIZ,CAACS,QAAD,EAAWf,IAAX,KAAoB;AAC1B,cAAMgB,CAAC,GAAGtB,iBAAiB,CAAC,cAAD,EAAiBM,IAAjB,CAA3B;;AAEA,YAAI,CAACG,QAAD,IAAca,CAAC,IAAIA,CAAC,CAACC,iBAAzB,EAA6C;AAC3CF,UAAAA,QAAQ,CAACG,IAAT,CAAcF,CAAd;AACD,SAFD,MAEO;AACLxD,UAAAA,GAAG,CAACM,IAAJ,CAAU,yBAAwBU,IAAI,CAAC0B,YAAa,YAAWF,IAAK,+BAApE;AACD;;AACD,eAAOe,QAAP;AACD,OAbmB,EAajB,EAbiB,CAAtB;AAeA,YAAM9B,aAAa,CAACC,aAAD,EAAgBV,IAAhB,EAAsB2B,QAAQ,GAAGF,MAAH,GAAYA,MAAM,CAACkB,QAAP,EAA1C,CAAnB;AACD,KAhCD;;AAAA,aAAsBC,UAAtB;AAAA;AAAA;;AAAA,WAAsBA,UAAtB;AAAA;AAiCD;;AAED9B,0BAA0B,CAAC+B,OAA3B,GAAqC,CAAC,sBAAD,EAAyB,8BAAzB,EAAyD,iBAAzD,EAA4E,mBAA5E,CAArC;AACAC,OAAO,CAAChC,0BAAR,GAAqCA,0BAArC","sourcesContent":["'use strict'\n\nconst util = require('util')\nconst fs = require('graceful-fs')\n// bind need only for mock unit tests\nconst readFile = util.promisify(fs.readFile.bind(fs))\nconst tryToRead = function (path, log) {\n  const maxRetries = 3\n  let promise = readFile(path)\n  for (let retryCount = 1; retryCount <= maxRetries; retryCount++) {\n    promise = promise.catch((err) => {\n      log.warn(err)\n      log.warn('retrying ' + retryCount)\n      return readFile(path)\n    })\n  }\n  return promise.catch((err) => {\n    log.warn(err)\n    return Promise.reject(err)\n  })\n}\n\nconst mm = require('minimatch')\nconst { isBinaryFile } = require('isbinaryfile')\nconst _ = require('lodash')\nconst CryptoUtils = require('./utils/crypto-utils')\n\nconst log = require('./logger').create('preprocess')\n\nfunction executeProcessor (process, file, content) {\n  let done = null\n  const donePromise = new Promise((resolve, reject) => {\n    done = function (error, content) {\n      // normalize B-C\n      if (arguments.length === 1 && typeof error === 'string') {\n        content = error\n        error = null\n      }\n      if (error) {\n        reject(error)\n      } else {\n        resolve(content)\n      }\n    }\n  })\n\n  return (process(content, file, done) || Promise.resolve()).then((content) => {\n    if (content) {\n      // async process correctly returned content\n      return content\n    }\n    // process called done() (Either old sync api or an async function that did not return content)\n    return donePromise\n  })\n}\n\nasync function runProcessors (preprocessors, file, content) {\n  try {\n    for (const process of preprocessors) {\n      content = await executeProcessor(process, file, content)\n    }\n  } catch (error) {\n    file.contentPath = null\n    file.content = null\n    throw error\n  }\n\n  file.contentPath = null\n  file.content = content\n  file.sha = CryptoUtils.sha1(content)\n}\n\nfunction createPriorityPreprocessor (config = {}, preprocessorPriority, basePath, instantiatePlugin) {\n  _.union.apply(_, Object.values(config)).forEach((name) => instantiatePlugin('preprocessor', name))\n  return async function preprocess (file) {\n    const buffer = await tryToRead(file.originalPath, log)\n    let isBinary = file.isBinary\n    if (isBinary == null) {\n      // Pattern did not specify, probe for it.\n      isBinary = await isBinaryFile(buffer, buffer.length)\n    }\n\n    const preprocessorNames = Object.keys(config).reduce((ppNames, pattern) => {\n      if (mm(file.originalPath, pattern, { dot: true })) {\n        ppNames = _.union(ppNames, config[pattern])\n      }\n      return ppNames\n    }, [])\n\n    // Apply preprocessor priority.\n    const preprocessors = preprocessorNames\n      .map((name) => [name, preprocessorPriority[name] || 0])\n      .sort((a, b) => b[1] - a[1])\n      .map((duo) => duo[0])\n      .reduce((preProcs, name) => {\n        const p = instantiatePlugin('preprocessor', name)\n\n        if (!isBinary || (p && p.handleBinaryFiles)) {\n          preProcs.push(p)\n        } else {\n          log.warn(`Ignored preprocessing ${file.originalPath} because ${name} has handleBinaryFiles=false.`)\n        }\n        return preProcs\n      }, [])\n\n    await runProcessors(preprocessors, file, isBinary ? buffer : buffer.toString())\n  }\n}\n\ncreatePriorityPreprocessor.$inject = ['config.preprocessors', 'config.preprocessor_priority', 'config.basePath', 'instantiatePlugin']\nexports.createPriorityPreprocessor = createPriorityPreprocessor\n"]},"metadata":{},"sourceType":"script"}