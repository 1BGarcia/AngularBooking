{"ast":null,"code":"\"use strict\";\n/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.webpackStatsLogger = exports.createWebpackLoggingCallback = exports.statsHasWarnings = exports.statsHasErrors = exports.statsErrorsToString = exports.statsWarningsToString = exports.generateBundleStats = exports.formatSize = void 0;\n\nconst core_1 = require(\"@angular-devkit/core\");\n\nconst path = __importStar(require(\"path\"));\n\nconst text_table_1 = __importDefault(require(\"text-table\"));\n\nconst color_1 = require(\"../../utils/color\");\n\nconst async_chunks_1 = require(\"./async-chunks\");\n\nconst helpers_1 = require(\"./helpers\");\n\nfunction formatSize(size) {\n  if (size <= 0) {\n    return '0 bytes';\n  }\n\n  const abbreviations = ['bytes', 'kB', 'MB', 'GB'];\n  const index = Math.floor(Math.log(size) / Math.log(1024));\n  const roundedSize = size / Math.pow(1024, index); // bytes don't have a fraction\n\n  const fractionDigits = index === 0 ? 0 : 2;\n  return `${roundedSize.toFixed(fractionDigits)} ${abbreviations[index]}`;\n}\n\nexports.formatSize = formatSize;\n\nfunction generateBundleStats(info) {\n  var _a, _b, _c;\n\n  const rawSize = typeof info.rawSize === 'number' ? info.rawSize : '-';\n  const estimatedTransferSize = typeof info.estimatedTransferSize === 'number' ? info.estimatedTransferSize : '-';\n  const files = (_b = (_a = info.files) === null || _a === void 0 ? void 0 : _a.filter(f => !f.endsWith('.map')).map(f => path.basename(f)).join(', ')) !== null && _b !== void 0 ? _b : '';\n  const names = ((_c = info.names) === null || _c === void 0 ? void 0 : _c.length) ? info.names.join(', ') : '-';\n  const initial = !!info.initial;\n  return {\n    initial,\n    stats: [files, names, rawSize, estimatedTransferSize]\n  };\n}\n\nexports.generateBundleStats = generateBundleStats;\n\nfunction generateBuildStatsTable(data, colors, showTotalSize, showEstimatedTransferSize, budgetFailures) {\n  const g = x => colors ? color_1.colors.greenBright(x) : x;\n\n  const c = x => colors ? color_1.colors.cyanBright(x) : x;\n\n  const r = x => colors ? color_1.colors.redBright(x) : x;\n\n  const y = x => colors ? color_1.colors.yellowBright(x) : x;\n\n  const bold = x => colors ? color_1.colors.bold(x) : x;\n\n  const dim = x => colors ? color_1.colors.dim(x) : x;\n\n  const getSizeColor = (name, file, defaultColor = c) => {\n    const severity = budgets.get(name) || file && budgets.get(file);\n\n    switch (severity) {\n      case 'warning':\n        return y;\n\n      case 'error':\n        return r;\n\n      default:\n        return defaultColor;\n    }\n  };\n\n  const changedEntryChunksStats = [];\n  const changedLazyChunksStats = [];\n  let initialTotalRawSize = 0;\n  let initialTotalEstimatedTransferSize;\n  const budgets = new Map();\n\n  if (budgetFailures) {\n    for (const {\n      label,\n      severity\n    } of budgetFailures) {\n      // In some cases a file can have multiple budget failures.\n      // Favor error.\n      if (label && (!budgets.has(label) || budgets.get(label) === 'warning')) {\n        budgets.set(label, severity);\n      }\n    }\n  }\n\n  for (const {\n    initial,\n    stats\n  } of data) {\n    const [files, names, rawSize, estimatedTransferSize] = stats;\n    const getRawSizeColor = getSizeColor(names, files);\n    let data;\n\n    if (showEstimatedTransferSize) {\n      data = [g(files), names, getRawSizeColor(typeof rawSize === 'number' ? formatSize(rawSize) : rawSize), c(typeof estimatedTransferSize === 'number' ? formatSize(estimatedTransferSize) : estimatedTransferSize)];\n    } else {\n      data = [g(files), names, getRawSizeColor(typeof rawSize === 'number' ? formatSize(rawSize) : rawSize), ''];\n    }\n\n    if (initial) {\n      changedEntryChunksStats.push(data);\n\n      if (typeof rawSize === 'number') {\n        initialTotalRawSize += rawSize;\n      }\n\n      if (showEstimatedTransferSize && typeof estimatedTransferSize === 'number') {\n        if (initialTotalEstimatedTransferSize === undefined) {\n          initialTotalEstimatedTransferSize = 0;\n        }\n\n        initialTotalEstimatedTransferSize += estimatedTransferSize;\n      }\n    } else {\n      changedLazyChunksStats.push(data);\n    }\n  }\n\n  const bundleInfo = [];\n  const baseTitles = ['Names', 'Raw Size'];\n  const tableAlign = ['l', 'l', 'r'];\n\n  if (showEstimatedTransferSize) {\n    baseTitles.push('Estimated Transfer Size');\n    tableAlign.push('r');\n  } // Entry chunks\n\n\n  if (changedEntryChunksStats.length) {\n    bundleInfo.push(['Initial Chunk Files', ...baseTitles].map(bold), ...changedEntryChunksStats);\n\n    if (showTotalSize) {\n      bundleInfo.push([]);\n      const initialSizeTotalColor = getSizeColor('bundle initial', undefined, x => x);\n      const totalSizeElements = [' ', 'Initial Total', initialSizeTotalColor(formatSize(initialTotalRawSize))];\n\n      if (showEstimatedTransferSize) {\n        totalSizeElements.push(typeof initialTotalEstimatedTransferSize === 'number' ? formatSize(initialTotalEstimatedTransferSize) : '-');\n      }\n\n      bundleInfo.push(totalSizeElements.map(bold));\n    }\n  } // Seperator\n\n\n  if (changedEntryChunksStats.length && changedLazyChunksStats.length) {\n    bundleInfo.push([]);\n  } // Lazy chunks\n\n\n  if (changedLazyChunksStats.length) {\n    bundleInfo.push(['Lazy Chunk Files', ...baseTitles].map(bold), ...changedLazyChunksStats);\n  }\n\n  return (0, text_table_1.default)(bundleInfo, {\n    hsep: dim(' | '),\n    stringLength: s => (0, color_1.removeColor)(s).length,\n    align: tableAlign\n  });\n}\n\nfunction generateBuildStats(hash, time, colors) {\n  const w = x => colors ? color_1.colors.bold.white(x) : x;\n\n  return `Build at: ${w(new Date().toISOString())} - Hash: ${w(hash)} - Time: ${w('' + time)}ms`;\n} // We use this cache because we can have multiple builders running in the same process,\n// where each builder has different output path.\n// Ideally, we should create the logging callback as a factory, but that would need a refactoring.\n\n\nconst runsCache = new Set();\n\nfunction statsToString(json, // eslint-disable-next-line @typescript-eslint/no-explicit-any\nstatsConfig, budgetFailures) {\n  var _a, _b;\n\n  if (!((_a = json.chunks) === null || _a === void 0 ? void 0 : _a.length)) {\n    return '';\n  }\n\n  const colors = statsConfig.colors;\n\n  const rs = x => colors ? color_1.colors.reset(x) : x;\n\n  const changedChunksStats = [];\n  let unchangedChunkNumber = 0;\n  let hasEstimatedTransferSizes = false;\n  const isFirstRun = !runsCache.has(json.outputPath || '');\n\n  for (const chunk of json.chunks) {\n    // During first build we want to display unchanged chunks\n    // but unchanged cached chunks are always marked as not rendered.\n    if (!isFirstRun && !chunk.rendered) {\n      continue;\n    }\n\n    const assets = (_b = json.assets) === null || _b === void 0 ? void 0 : _b.filter(asset => {\n      var _a;\n\n      return (_a = chunk.files) === null || _a === void 0 ? void 0 : _a.includes(asset.name);\n    });\n    let rawSize = 0;\n    let estimatedTransferSize;\n\n    if (assets) {\n      for (const asset of assets) {\n        if (asset.name.endsWith('.map')) {\n          continue;\n        }\n\n        rawSize += asset.size;\n\n        if (typeof asset.info.estimatedTransferSize === 'number') {\n          if (estimatedTransferSize === undefined) {\n            estimatedTransferSize = 0;\n            hasEstimatedTransferSizes = true;\n          }\n\n          estimatedTransferSize += asset.info.estimatedTransferSize;\n        }\n      }\n    }\n\n    changedChunksStats.push(generateBundleStats({ ...chunk,\n      rawSize,\n      estimatedTransferSize\n    }));\n  }\n\n  unchangedChunkNumber = json.chunks.length - changedChunksStats.length;\n  runsCache.add(json.outputPath || ''); // Sort chunks by size in descending order\n\n  changedChunksStats.sort((a, b) => {\n    if (a.stats[2] > b.stats[2]) {\n      return -1;\n    }\n\n    if (a.stats[2] < b.stats[2]) {\n      return 1;\n    }\n\n    return 0;\n  });\n  const statsTable = generateBuildStatsTable(changedChunksStats, colors, unchangedChunkNumber === 0, hasEstimatedTransferSizes, budgetFailures); // In some cases we do things outside of webpack context\n  // Such us index generation, service worker augmentation etc...\n  // This will correct the time and include these.\n\n  let time = 0;\n\n  if (json.builtAt !== undefined && json.time !== undefined) {\n    time = Date.now() - json.builtAt + json.time;\n  }\n\n  if (unchangedChunkNumber > 0) {\n    return '\\n' + rs(core_1.tags.stripIndents`\n      ${statsTable}\n\n      ${unchangedChunkNumber} unchanged chunks\n\n      ${generateBuildStats(json.hash || '', time, colors)}\n      `);\n  } else {\n    return '\\n' + rs(core_1.tags.stripIndents`\n      ${statsTable}\n\n      ${generateBuildStats(json.hash || '', time, colors)}\n      `);\n  }\n} // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\nfunction statsWarningsToString(json, statsConfig) {\n  const colors = statsConfig.colors;\n\n  const c = x => colors ? color_1.colors.reset.cyan(x) : x;\n\n  const y = x => colors ? color_1.colors.reset.yellow(x) : x;\n\n  const yb = x => colors ? color_1.colors.reset.yellowBright(x) : x;\n\n  const warnings = json.warnings ? [...json.warnings] : [];\n\n  if (json.children) {\n    warnings.push(...json.children.map(c => {\n      var _a;\n\n      return (_a = c.warnings) !== null && _a !== void 0 ? _a : [];\n    }).reduce((a, b) => [...a, ...b], []));\n  }\n\n  let output = '';\n\n  for (const warning of warnings) {\n    if (typeof warning === 'string') {\n      output += yb(`Warning: ${warning}\\n\\n`);\n    } else {\n      const file = warning.file || warning.moduleName;\n\n      if (file) {\n        output += c(file);\n\n        if (warning.loc) {\n          output += ':' + yb(warning.loc);\n        }\n\n        output += ' - ';\n      }\n\n      if (!/^warning/i.test(warning.message)) {\n        output += y('Warning: ');\n      }\n\n      output += `${warning.message}\\n\\n`;\n    }\n  }\n\n  return output ? '\\n' + output : output;\n}\n\nexports.statsWarningsToString = statsWarningsToString; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\nfunction statsErrorsToString(json, statsConfig) {\n  const colors = statsConfig.colors;\n\n  const c = x => colors ? color_1.colors.reset.cyan(x) : x;\n\n  const yb = x => colors ? color_1.colors.reset.yellowBright(x) : x;\n\n  const r = x => colors ? color_1.colors.reset.redBright(x) : x;\n\n  const errors = json.errors ? [...json.errors] : [];\n\n  if (json.children) {\n    errors.push(...json.children.map(c => (c === null || c === void 0 ? void 0 : c.errors) || []).reduce((a, b) => [...a, ...b], []));\n  }\n\n  let output = '';\n\n  for (const error of errors) {\n    if (typeof error === 'string') {\n      output += r(`Error: ${error}\\n\\n`);\n    } else {\n      const file = error.file || error.moduleName;\n\n      if (file) {\n        output += c(file);\n\n        if (error.loc) {\n          output += ':' + yb(error.loc);\n        }\n\n        output += ' - ';\n      }\n\n      if (!/^error/i.test(error.message)) {\n        output += r('Error: ');\n      }\n\n      output += `${error.message}\\n\\n`;\n    }\n  }\n\n  return output ? '\\n' + output : output;\n}\n\nexports.statsErrorsToString = statsErrorsToString;\n\nfunction statsHasErrors(json) {\n  var _a, _b;\n\n  return !!(((_a = json.errors) === null || _a === void 0 ? void 0 : _a.length) || ((_b = json.children) === null || _b === void 0 ? void 0 : _b.some(c => {\n    var _a;\n\n    return (_a = c.errors) === null || _a === void 0 ? void 0 : _a.length;\n  })));\n}\n\nexports.statsHasErrors = statsHasErrors;\n\nfunction statsHasWarnings(json) {\n  var _a, _b;\n\n  return !!(((_a = json.warnings) === null || _a === void 0 ? void 0 : _a.length) || ((_b = json.children) === null || _b === void 0 ? void 0 : _b.some(c => {\n    var _a;\n\n    return (_a = c.warnings) === null || _a === void 0 ? void 0 : _a.length;\n  })));\n}\n\nexports.statsHasWarnings = statsHasWarnings;\n\nfunction createWebpackLoggingCallback(options, logger) {\n  const {\n    verbose = false,\n    scripts = [],\n    styles = []\n  } = options;\n  const extraEntryPoints = [...(0, helpers_1.normalizeExtraEntryPoints)(styles, 'styles'), ...(0, helpers_1.normalizeExtraEntryPoints)(scripts, 'scripts')];\n  return (stats, config) => {\n    if (verbose) {\n      logger.info(stats.toString(config.stats));\n    }\n\n    const rawStats = stats.toJson((0, helpers_1.getStatsOptions)(false));\n    const webpackStats = { ...rawStats,\n      chunks: (0, async_chunks_1.markAsyncChunksNonInitial)(rawStats, extraEntryPoints)\n    };\n    webpackStatsLogger(logger, webpackStats, config);\n  };\n}\n\nexports.createWebpackLoggingCallback = createWebpackLoggingCallback;\n\nfunction webpackStatsLogger(logger, json, config, budgetFailures) {\n  logger.info(statsToString(json, config.stats, budgetFailures));\n\n  if (statsHasWarnings(json)) {\n    logger.warn(statsWarningsToString(json, config.stats));\n  }\n\n  if (statsHasErrors(json)) {\n    logger.error(statsErrorsToString(json, config.stats));\n  }\n}\n\nexports.webpackStatsLogger = webpackStatsLogger;","map":{"version":3,"sources":["E:/M7ProyectoAngular/node_modules/@angular-devkit/build-angular/src/webpack/utils/stats.js"],"names":["__createBinding","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","__importDefault","exports","webpackStatsLogger","createWebpackLoggingCallback","statsHasWarnings","statsHasErrors","statsErrorsToString","statsWarningsToString","generateBundleStats","formatSize","core_1","require","path","text_table_1","color_1","async_chunks_1","helpers_1","size","abbreviations","index","Math","floor","log","roundedSize","pow","fractionDigits","toFixed","info","_a","_b","_c","rawSize","estimatedTransferSize","files","filter","f","endsWith","map","basename","join","names","length","initial","stats","generateBuildStatsTable","data","colors","showTotalSize","showEstimatedTransferSize","budgetFailures","g","x","greenBright","c","cyanBright","r","redBright","y","yellowBright","bold","dim","getSizeColor","name","file","defaultColor","severity","budgets","changedEntryChunksStats","changedLazyChunksStats","initialTotalRawSize","initialTotalEstimatedTransferSize","Map","label","has","set","getRawSizeColor","push","bundleInfo","baseTitles","tableAlign","initialSizeTotalColor","totalSizeElements","default","hsep","stringLength","s","removeColor","align","generateBuildStats","hash","time","w","white","Date","toISOString","runsCache","Set","statsToString","json","statsConfig","chunks","rs","reset","changedChunksStats","unchangedChunkNumber","hasEstimatedTransferSizes","isFirstRun","outputPath","chunk","rendered","assets","asset","includes","add","sort","a","b","statsTable","builtAt","now","tags","stripIndents","cyan","yellow","yb","warnings","children","reduce","output","warning","moduleName","loc","test","message","errors","error","some","options","logger","verbose","scripts","styles","extraEntryPoints","normalizeExtraEntryPoints","config","toString","rawStats","toJson","getStatsOptions","webpackStats","markAsyncChunksNonInitial","warn"],"mappings":"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","sourcesContent":["\"use strict\";\n/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.webpackStatsLogger = exports.createWebpackLoggingCallback = exports.statsHasWarnings = exports.statsHasErrors = exports.statsErrorsToString = exports.statsWarningsToString = exports.generateBundleStats = exports.formatSize = void 0;\nconst core_1 = require(\"@angular-devkit/core\");\nconst path = __importStar(require(\"path\"));\nconst text_table_1 = __importDefault(require(\"text-table\"));\nconst color_1 = require(\"../../utils/color\");\nconst async_chunks_1 = require(\"./async-chunks\");\nconst helpers_1 = require(\"./helpers\");\nfunction formatSize(size) {\n    if (size <= 0) {\n        return '0 bytes';\n    }\n    const abbreviations = ['bytes', 'kB', 'MB', 'GB'];\n    const index = Math.floor(Math.log(size) / Math.log(1024));\n    const roundedSize = size / Math.pow(1024, index);\n    // bytes don't have a fraction\n    const fractionDigits = index === 0 ? 0 : 2;\n    return `${roundedSize.toFixed(fractionDigits)} ${abbreviations[index]}`;\n}\nexports.formatSize = formatSize;\nfunction generateBundleStats(info) {\n    var _a, _b, _c;\n    const rawSize = typeof info.rawSize === 'number' ? info.rawSize : '-';\n    const estimatedTransferSize = typeof info.estimatedTransferSize === 'number' ? info.estimatedTransferSize : '-';\n    const files = (_b = (_a = info.files) === null || _a === void 0 ? void 0 : _a.filter((f) => !f.endsWith('.map')).map((f) => path.basename(f)).join(', ')) !== null && _b !== void 0 ? _b : '';\n    const names = ((_c = info.names) === null || _c === void 0 ? void 0 : _c.length) ? info.names.join(', ') : '-';\n    const initial = !!info.initial;\n    return {\n        initial,\n        stats: [files, names, rawSize, estimatedTransferSize],\n    };\n}\nexports.generateBundleStats = generateBundleStats;\nfunction generateBuildStatsTable(data, colors, showTotalSize, showEstimatedTransferSize, budgetFailures) {\n    const g = (x) => (colors ? color_1.colors.greenBright(x) : x);\n    const c = (x) => (colors ? color_1.colors.cyanBright(x) : x);\n    const r = (x) => (colors ? color_1.colors.redBright(x) : x);\n    const y = (x) => (colors ? color_1.colors.yellowBright(x) : x);\n    const bold = (x) => (colors ? color_1.colors.bold(x) : x);\n    const dim = (x) => (colors ? color_1.colors.dim(x) : x);\n    const getSizeColor = (name, file, defaultColor = c) => {\n        const severity = budgets.get(name) || (file && budgets.get(file));\n        switch (severity) {\n            case 'warning':\n                return y;\n            case 'error':\n                return r;\n            default:\n                return defaultColor;\n        }\n    };\n    const changedEntryChunksStats = [];\n    const changedLazyChunksStats = [];\n    let initialTotalRawSize = 0;\n    let initialTotalEstimatedTransferSize;\n    const budgets = new Map();\n    if (budgetFailures) {\n        for (const { label, severity } of budgetFailures) {\n            // In some cases a file can have multiple budget failures.\n            // Favor error.\n            if (label && (!budgets.has(label) || budgets.get(label) === 'warning')) {\n                budgets.set(label, severity);\n            }\n        }\n    }\n    for (const { initial, stats } of data) {\n        const [files, names, rawSize, estimatedTransferSize] = stats;\n        const getRawSizeColor = getSizeColor(names, files);\n        let data;\n        if (showEstimatedTransferSize) {\n            data = [\n                g(files),\n                names,\n                getRawSizeColor(typeof rawSize === 'number' ? formatSize(rawSize) : rawSize),\n                c(typeof estimatedTransferSize === 'number'\n                    ? formatSize(estimatedTransferSize)\n                    : estimatedTransferSize),\n            ];\n        }\n        else {\n            data = [\n                g(files),\n                names,\n                getRawSizeColor(typeof rawSize === 'number' ? formatSize(rawSize) : rawSize),\n                '',\n            ];\n        }\n        if (initial) {\n            changedEntryChunksStats.push(data);\n            if (typeof rawSize === 'number') {\n                initialTotalRawSize += rawSize;\n            }\n            if (showEstimatedTransferSize && typeof estimatedTransferSize === 'number') {\n                if (initialTotalEstimatedTransferSize === undefined) {\n                    initialTotalEstimatedTransferSize = 0;\n                }\n                initialTotalEstimatedTransferSize += estimatedTransferSize;\n            }\n        }\n        else {\n            changedLazyChunksStats.push(data);\n        }\n    }\n    const bundleInfo = [];\n    const baseTitles = ['Names', 'Raw Size'];\n    const tableAlign = ['l', 'l', 'r'];\n    if (showEstimatedTransferSize) {\n        baseTitles.push('Estimated Transfer Size');\n        tableAlign.push('r');\n    }\n    // Entry chunks\n    if (changedEntryChunksStats.length) {\n        bundleInfo.push(['Initial Chunk Files', ...baseTitles].map(bold), ...changedEntryChunksStats);\n        if (showTotalSize) {\n            bundleInfo.push([]);\n            const initialSizeTotalColor = getSizeColor('bundle initial', undefined, (x) => x);\n            const totalSizeElements = [\n                ' ',\n                'Initial Total',\n                initialSizeTotalColor(formatSize(initialTotalRawSize)),\n            ];\n            if (showEstimatedTransferSize) {\n                totalSizeElements.push(typeof initialTotalEstimatedTransferSize === 'number'\n                    ? formatSize(initialTotalEstimatedTransferSize)\n                    : '-');\n            }\n            bundleInfo.push(totalSizeElements.map(bold));\n        }\n    }\n    // Seperator\n    if (changedEntryChunksStats.length && changedLazyChunksStats.length) {\n        bundleInfo.push([]);\n    }\n    // Lazy chunks\n    if (changedLazyChunksStats.length) {\n        bundleInfo.push(['Lazy Chunk Files', ...baseTitles].map(bold), ...changedLazyChunksStats);\n    }\n    return (0, text_table_1.default)(bundleInfo, {\n        hsep: dim(' | '),\n        stringLength: (s) => (0, color_1.removeColor)(s).length,\n        align: tableAlign,\n    });\n}\nfunction generateBuildStats(hash, time, colors) {\n    const w = (x) => (colors ? color_1.colors.bold.white(x) : x);\n    return `Build at: ${w(new Date().toISOString())} - Hash: ${w(hash)} - Time: ${w('' + time)}ms`;\n}\n// We use this cache because we can have multiple builders running in the same process,\n// where each builder has different output path.\n// Ideally, we should create the logging callback as a factory, but that would need a refactoring.\nconst runsCache = new Set();\nfunction statsToString(json, \n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nstatsConfig, budgetFailures) {\n    var _a, _b;\n    if (!((_a = json.chunks) === null || _a === void 0 ? void 0 : _a.length)) {\n        return '';\n    }\n    const colors = statsConfig.colors;\n    const rs = (x) => (colors ? color_1.colors.reset(x) : x);\n    const changedChunksStats = [];\n    let unchangedChunkNumber = 0;\n    let hasEstimatedTransferSizes = false;\n    const isFirstRun = !runsCache.has(json.outputPath || '');\n    for (const chunk of json.chunks) {\n        // During first build we want to display unchanged chunks\n        // but unchanged cached chunks are always marked as not rendered.\n        if (!isFirstRun && !chunk.rendered) {\n            continue;\n        }\n        const assets = (_b = json.assets) === null || _b === void 0 ? void 0 : _b.filter((asset) => { var _a; return (_a = chunk.files) === null || _a === void 0 ? void 0 : _a.includes(asset.name); });\n        let rawSize = 0;\n        let estimatedTransferSize;\n        if (assets) {\n            for (const asset of assets) {\n                if (asset.name.endsWith('.map')) {\n                    continue;\n                }\n                rawSize += asset.size;\n                if (typeof asset.info.estimatedTransferSize === 'number') {\n                    if (estimatedTransferSize === undefined) {\n                        estimatedTransferSize = 0;\n                        hasEstimatedTransferSizes = true;\n                    }\n                    estimatedTransferSize += asset.info.estimatedTransferSize;\n                }\n            }\n        }\n        changedChunksStats.push(generateBundleStats({ ...chunk, rawSize, estimatedTransferSize }));\n    }\n    unchangedChunkNumber = json.chunks.length - changedChunksStats.length;\n    runsCache.add(json.outputPath || '');\n    // Sort chunks by size in descending order\n    changedChunksStats.sort((a, b) => {\n        if (a.stats[2] > b.stats[2]) {\n            return -1;\n        }\n        if (a.stats[2] < b.stats[2]) {\n            return 1;\n        }\n        return 0;\n    });\n    const statsTable = generateBuildStatsTable(changedChunksStats, colors, unchangedChunkNumber === 0, hasEstimatedTransferSizes, budgetFailures);\n    // In some cases we do things outside of webpack context\n    // Such us index generation, service worker augmentation etc...\n    // This will correct the time and include these.\n    let time = 0;\n    if (json.builtAt !== undefined && json.time !== undefined) {\n        time = Date.now() - json.builtAt + json.time;\n    }\n    if (unchangedChunkNumber > 0) {\n        return ('\\n' +\n            rs(core_1.tags.stripIndents `\n      ${statsTable}\n\n      ${unchangedChunkNumber} unchanged chunks\n\n      ${generateBuildStats(json.hash || '', time, colors)}\n      `));\n    }\n    else {\n        return ('\\n' +\n            rs(core_1.tags.stripIndents `\n      ${statsTable}\n\n      ${generateBuildStats(json.hash || '', time, colors)}\n      `));\n    }\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction statsWarningsToString(json, statsConfig) {\n    const colors = statsConfig.colors;\n    const c = (x) => (colors ? color_1.colors.reset.cyan(x) : x);\n    const y = (x) => (colors ? color_1.colors.reset.yellow(x) : x);\n    const yb = (x) => (colors ? color_1.colors.reset.yellowBright(x) : x);\n    const warnings = json.warnings ? [...json.warnings] : [];\n    if (json.children) {\n        warnings.push(...json.children.map((c) => { var _a; return (_a = c.warnings) !== null && _a !== void 0 ? _a : []; }).reduce((a, b) => [...a, ...b], []));\n    }\n    let output = '';\n    for (const warning of warnings) {\n        if (typeof warning === 'string') {\n            output += yb(`Warning: ${warning}\\n\\n`);\n        }\n        else {\n            const file = warning.file || warning.moduleName;\n            if (file) {\n                output += c(file);\n                if (warning.loc) {\n                    output += ':' + yb(warning.loc);\n                }\n                output += ' - ';\n            }\n            if (!/^warning/i.test(warning.message)) {\n                output += y('Warning: ');\n            }\n            output += `${warning.message}\\n\\n`;\n        }\n    }\n    return output ? '\\n' + output : output;\n}\nexports.statsWarningsToString = statsWarningsToString;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction statsErrorsToString(json, statsConfig) {\n    const colors = statsConfig.colors;\n    const c = (x) => (colors ? color_1.colors.reset.cyan(x) : x);\n    const yb = (x) => (colors ? color_1.colors.reset.yellowBright(x) : x);\n    const r = (x) => (colors ? color_1.colors.reset.redBright(x) : x);\n    const errors = json.errors ? [...json.errors] : [];\n    if (json.children) {\n        errors.push(...json.children.map((c) => (c === null || c === void 0 ? void 0 : c.errors) || []).reduce((a, b) => [...a, ...b], []));\n    }\n    let output = '';\n    for (const error of errors) {\n        if (typeof error === 'string') {\n            output += r(`Error: ${error}\\n\\n`);\n        }\n        else {\n            const file = error.file || error.moduleName;\n            if (file) {\n                output += c(file);\n                if (error.loc) {\n                    output += ':' + yb(error.loc);\n                }\n                output += ' - ';\n            }\n            if (!/^error/i.test(error.message)) {\n                output += r('Error: ');\n            }\n            output += `${error.message}\\n\\n`;\n        }\n    }\n    return output ? '\\n' + output : output;\n}\nexports.statsErrorsToString = statsErrorsToString;\nfunction statsHasErrors(json) {\n    var _a, _b;\n    return !!(((_a = json.errors) === null || _a === void 0 ? void 0 : _a.length) || ((_b = json.children) === null || _b === void 0 ? void 0 : _b.some((c) => { var _a; return (_a = c.errors) === null || _a === void 0 ? void 0 : _a.length; })));\n}\nexports.statsHasErrors = statsHasErrors;\nfunction statsHasWarnings(json) {\n    var _a, _b;\n    return !!(((_a = json.warnings) === null || _a === void 0 ? void 0 : _a.length) || ((_b = json.children) === null || _b === void 0 ? void 0 : _b.some((c) => { var _a; return (_a = c.warnings) === null || _a === void 0 ? void 0 : _a.length; })));\n}\nexports.statsHasWarnings = statsHasWarnings;\nfunction createWebpackLoggingCallback(options, logger) {\n    const { verbose = false, scripts = [], styles = [] } = options;\n    const extraEntryPoints = [\n        ...(0, helpers_1.normalizeExtraEntryPoints)(styles, 'styles'),\n        ...(0, helpers_1.normalizeExtraEntryPoints)(scripts, 'scripts'),\n    ];\n    return (stats, config) => {\n        if (verbose) {\n            logger.info(stats.toString(config.stats));\n        }\n        const rawStats = stats.toJson((0, helpers_1.getStatsOptions)(false));\n        const webpackStats = {\n            ...rawStats,\n            chunks: (0, async_chunks_1.markAsyncChunksNonInitial)(rawStats, extraEntryPoints),\n        };\n        webpackStatsLogger(logger, webpackStats, config);\n    };\n}\nexports.createWebpackLoggingCallback = createWebpackLoggingCallback;\nfunction webpackStatsLogger(logger, json, config, budgetFailures) {\n    logger.info(statsToString(json, config.stats, budgetFailures));\n    if (statsHasWarnings(json)) {\n        logger.warn(statsWarningsToString(json, config.stats));\n    }\n    if (statsHasErrors(json)) {\n        logger.error(statsErrorsToString(json, config.stats));\n    }\n}\nexports.webpackStatsLogger = webpackStatsLogger;\n"]},"metadata":{},"sourceType":"script"}